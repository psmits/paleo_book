<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Varying-intercept models | Analytical Paleobiology</title>
  <meta name="description" content="An informal course on analytical paleobiology" />
  <meta name="generator" content="bookdown 0.10 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Varying-intercept models | Analytical Paleobiology" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An informal course on analytical paleobiology" />
  <meta name="github-repo" content="psmits/paleo_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Varying-intercept models | Analytical Paleobiology" />
  <meta name="twitter:site" content="@PeterDSmits" />
  <meta name="twitter:description" content="An informal course on analytical paleobiology" />
  

<meta name="author" content="Peter D Smits" />


<meta name="date" content="2019-05-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="poisson-regression-and-others-glms.html">
<link rel="next" href="vary-all.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="...">Short-Course on Analytical Paleobiology</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html"><i class="fa fa-check"></i><b>1</b> Managing and Processing Data From the Paleobiology Database</a><ul>
<li class="chapter" data-level="1.1" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#project-reading"><i class="fa fa-check"></i><b>1.2</b> Reading</a></li>
<li class="chapter" data-level="1.3" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#introduction"><i class="fa fa-check"></i><b>1.3</b> Introduction</a></li>
<li class="chapter" data-level="1.4" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#getting-data"><i class="fa fa-check"></i><b>1.4</b> Getting data</a></li>
<li class="chapter" data-level="1.5" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#processing-data"><i class="fa fa-check"></i><b>1.5</b> Processing data</a></li>
<li class="chapter" data-level="1.6" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#binning-observations"><i class="fa fa-check"></i><b>1.6</b> Binning observations</a></li>
<li class="chapter" data-level="1.7" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#sharing-data"><i class="fa fa-check"></i><b>1.7</b> Sharing data</a></li>
<li class="chapter" data-level="1.8" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#summary"><i class="fa fa-check"></i><b>1.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html"><i class="fa fa-check"></i><b>2</b> Introduction to Bayesian data analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#objectives-1"><i class="fa fa-check"></i><b>2.1</b> Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#reading"><i class="fa fa-check"></i><b>2.2</b> Reading</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#learning-from-data"><i class="fa fa-check"></i><b>2.3</b> Learning from data</a><ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#counting-and-plausibility"><i class="fa fa-check"></i><b>2.3.1</b> Counting and plausibility</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#globe-example"><i class="fa fa-check"></i><b>2.4</b> Building a model</a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#a-data-story"><i class="fa fa-check"></i><b>2.4.1</b> A data story</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#bayes-updating-ex"><i class="fa fa-check"></i><b>2.4.2</b> Bayesian updating</a></li>
<li class="chapter" data-level="2.4.3" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#evaluate"><i class="fa fa-check"></i><b>2.4.3</b> Evaluate</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#terms-and-theory"><i class="fa fa-check"></i><b>2.5</b> Terms and theory</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#bayes-theorem"><i class="fa fa-check"></i><b>2.6</b> Bayes’ Theorem</a></li>
<li class="chapter" data-level="2.7" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#but-how-does-it-work"><i class="fa fa-check"></i><b>2.7</b> But how does it <em>work</em>?</a><ul>
<li class="chapter" data-level="2.7.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#grid-approximation"><i class="fa fa-check"></i><b>2.7.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.7.2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>2.7.2</b> Markov chain Monte Carlo</a></li>
<li class="chapter" data-level="2.7.3" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#aside-on-interpreting-probabilities"><i class="fa fa-check"></i><b>2.7.3</b> Aside on Interpreting Probabilities</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#working-with-samples"><i class="fa fa-check"></i><b>2.8</b> Working with samples</a><ul>
<li class="chapter" data-level="2.8.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#intervals-of-defined-boundaries"><i class="fa fa-check"></i><b>2.8.1</b> Intervals of defined boundaries</a></li>
<li class="chapter" data-level="2.8.2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>2.8.2</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="2.8.3" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#point-estimates"><i class="fa fa-check"></i><b>2.8.3</b> Point estimates</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#summary-1"><i class="fa fa-check"></i><b>2.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reg-intro.html"><a href="reg-intro.html"><i class="fa fa-check"></i><b>3</b> Introduction to linear regression</a><ul>
<li class="chapter" data-level="3.1" data-path="reg-intro.html"><a href="reg-intro.html#objectives-2"><i class="fa fa-check"></i><b>3.1</b> Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="reg-intro.html"><a href="reg-intro.html#reading-1"><i class="fa fa-check"></i><b>3.2</b> Reading</a></li>
<li class="chapter" data-level="3.3" data-path="reg-intro.html"><a href="reg-intro.html#linear-regression"><i class="fa fa-check"></i><b>3.3</b> Linear regression</a><ul>
<li class="chapter" data-level="3.3.1" data-path="reg-intro.html"><a href="reg-intro.html#talking-about-models"><i class="fa fa-check"></i><b>3.3.1</b> Talking about models</a></li>
<li class="chapter" data-level="3.3.2" data-path="reg-intro.html"><a href="reg-intro.html#growing-a-regression-model"><i class="fa fa-check"></i><b>3.3.2</b> Growing a regression model</a></li>
<li class="chapter" data-level="3.3.3" data-path="reg-intro.html"><a href="reg-intro.html#sampling-from-the-model"><i class="fa fa-check"></i><b>3.3.3</b> Sampling from the model</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="reg-intro.html"><a href="reg-intro.html#adding-a-predictor-to-the-mix"><i class="fa fa-check"></i><b>3.4</b> Adding a predictor to the mix</a><ul>
<li class="chapter" data-level="3.4.1" data-path="reg-intro.html"><a href="reg-intro.html#aside-dummy-coding"><i class="fa fa-check"></i><b>3.4.1</b> Aside: Dummy coding</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="reg-intro.html"><a href="reg-intro.html#interpreting-the-model-fit"><i class="fa fa-check"></i><b>3.5</b> Interpreting the model fit</a><ul>
<li class="chapter" data-level="3.5.1" data-path="reg-intro.html"><a href="reg-intro.html#linear-predictor"><i class="fa fa-check"></i><b>3.5.1</b> Linear predictor</a></li>
<li class="chapter" data-level="3.5.2" data-path="reg-intro.html"><a href="reg-intro.html#posterior-prediction"><i class="fa fa-check"></i><b>3.5.2</b> Posterior prediction</a></li>
<li class="chapter" data-level="3.5.3" data-path="reg-intro.html"><a href="reg-intro.html#posterior-predictive-tests"><i class="fa fa-check"></i><b>3.5.3</b> Posterior predictive tests</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="reg-intro.html"><a href="reg-intro.html#summary-2"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reg-continue.html"><a href="reg-continue.html"><i class="fa fa-check"></i><b>4</b> Continuing with regression with continuous predictors</a><ul>
<li class="chapter" data-level="4.1" data-path="reg-continue.html"><a href="reg-continue.html#objectives-3"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="reg-continue.html"><a href="reg-continue.html#reading-2"><i class="fa fa-check"></i><b>4.2</b> Reading</a></li>
<li class="chapter" data-level="4.3" data-path="reg-continue.html"><a href="reg-continue.html#our-first-example"><i class="fa fa-check"></i><b>4.3</b> Our first example</a></li>
<li class="chapter" data-level="4.4" data-path="reg-continue.html"><a href="reg-continue.html#a-single-continuous-predictor"><i class="fa fa-check"></i><b>4.4</b> A single continuous predictor</a><ul>
<li class="chapter" data-level="4.4.1" data-path="reg-continue.html"><a href="reg-continue.html#centering"><i class="fa fa-check"></i><b>4.4.1</b> Aside: Centering</a></li>
<li class="chapter" data-level="4.4.2" data-path="reg-continue.html"><a href="reg-continue.html#continue-ppc"><i class="fa fa-check"></i><b>4.4.2</b> Checking model fit</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="reg-continue.html"><a href="reg-continue.html#summary-3"><i class="fa fa-check"></i><b>4.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="reg-multi.html"><a href="reg-multi.html"><i class="fa fa-check"></i><b>5</b> Multiple predictors in linear regression</a><ul>
<li class="chapter" data-level="5.1" data-path="reg-multi.html"><a href="reg-multi.html#objectives-4"><i class="fa fa-check"></i><b>5.1</b> Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="reg-multi.html"><a href="reg-multi.html#reading-3"><i class="fa fa-check"></i><b>5.2</b> Reading</a></li>
<li class="chapter" data-level="5.3" data-path="reg-multi.html"><a href="reg-multi.html#more-than-one-predictor"><i class="fa fa-check"></i><b>5.3</b> More than one predictor</a><ul>
<li class="chapter" data-level="5.3.1" data-path="reg-multi.html"><a href="reg-multi.html#dummy"><i class="fa fa-check"></i><b>5.3.1</b> Categorical predictor</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="reg-multi.html"><a href="reg-multi.html#defining-our-model"><i class="fa fa-check"></i><b>5.4</b> Defining our model</a></li>
<li class="chapter" data-level="5.5" data-path="reg-multi.html"><a href="reg-multi.html#fitting-model-in-brms"><i class="fa fa-check"></i><b>5.5</b> Fitting model in <code>brms</code></a></li>
<li class="chapter" data-level="5.6" data-path="reg-multi.html"><a href="reg-multi.html#aside-standardizing"><i class="fa fa-check"></i><b>5.6</b> Aside: Standardizing</a></li>
<li class="chapter" data-level="5.7" data-path="reg-multi.html"><a href="reg-multi.html#multi-ppc"><i class="fa fa-check"></i><b>5.7</b> Checking model fit</a></li>
<li class="chapter" data-level="5.8" data-path="reg-multi.html"><a href="reg-multi.html#matrix-notation"><i class="fa fa-check"></i><b>5.8</b> Aside: Matrix Notation</a></li>
<li class="chapter" data-level="5.9" data-path="reg-multi.html"><a href="reg-multi.html#summary-4"><i class="fa fa-check"></i><b>5.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="interactions.html"><a href="interactions.html"><i class="fa fa-check"></i><b>6</b> Interactions</a><ul>
<li class="chapter" data-level="6.1" data-path="interactions.html"><a href="interactions.html#objectives-5"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="interactions.html"><a href="interactions.html#reading-4"><i class="fa fa-check"></i><b>6.2</b> Reading</a></li>
<li class="chapter" data-level="6.3" data-path="interactions.html"><a href="interactions.html#introduction-1"><i class="fa fa-check"></i><b>6.3</b> Introduction</a></li>
<li class="chapter" data-level="6.4" data-path="interactions.html"><a href="interactions.html#inter-initial"><i class="fa fa-check"></i><b>6.4</b> Data and inital model</a></li>
<li class="chapter" data-level="6.5" data-path="interactions.html"><a href="interactions.html#how-to-specify-an-interaction"><i class="fa fa-check"></i><b>6.5</b> How to specify an interaction</a><ul>
<li class="chapter" data-level="6.5.1" data-path="interactions.html"><a href="interactions.html#symmetry-of-interactions"><i class="fa fa-check"></i><b>6.5.1</b> Symmetry of interactions</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="interactions.html"><a href="interactions.html#fitting-a-model-with-an-interaction"><i class="fa fa-check"></i><b>6.6</b> Fitting a model with an interaction</a></li>
<li class="chapter" data-level="6.7" data-path="interactions.html"><a href="interactions.html#interpreting-our-model"><i class="fa fa-check"></i><b>6.7</b> Interpreting our model</a></li>
<li class="chapter" data-level="6.8" data-path="interactions.html"><a href="interactions.html#have-we-improved-on-our-previous-model"><i class="fa fa-check"></i><b>6.8</b> Have we improved on our previous model?</a></li>
<li class="chapter" data-level="6.9" data-path="interactions.html"><a href="interactions.html#continuouscontinuous-interactions"><i class="fa fa-check"></i><b>6.9</b> Continuous–Continuous interactions</a></li>
<li class="chapter" data-level="6.10" data-path="interactions.html"><a href="interactions.html#summary-5"><i class="fa fa-check"></i><b>6.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>7</b> Logistic regression</a><ul>
<li class="chapter" data-level="7.1" data-path="logistic-regression.html"><a href="logistic-regression.html#objectives-6"><i class="fa fa-check"></i><b>7.1</b> Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="logistic-regression.html"><a href="logistic-regression.html#reading-5"><i class="fa fa-check"></i><b>7.2</b> Reading</a></li>
<li class="chapter" data-level="7.3" data-path="logistic-regression.html"><a href="logistic-regression.html#introduction-2"><i class="fa fa-check"></i><b>7.3</b> Introduction</a></li>
<li class="chapter" data-level="7.4" data-path="logistic-regression.html"><a href="logistic-regression.html#foram-coiling"><i class="fa fa-check"></i><b>7.4</b> Foram coiling</a></li>
<li class="chapter" data-level="7.5" data-path="logistic-regression.html"><a href="logistic-regression.html#writing-out-a-model"><i class="fa fa-check"></i><b>7.5</b> Writing out a model</a><ul>
<li class="chapter" data-level="7.5.1" data-path="logistic-regression.html"><a href="logistic-regression.html#interpreting-logistic-regression-coefficients"><i class="fa fa-check"></i><b>7.5.1</b> Interpreting logistic regression coefficients</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="logistic-regression.html"><a href="logistic-regression.html#priors-for-our-model"><i class="fa fa-check"></i><b>7.6</b> Priors for our model</a></li>
<li class="chapter" data-level="7.7" data-path="logistic-regression.html"><a href="logistic-regression.html#fitting-our-model"><i class="fa fa-check"></i><b>7.7</b> Fitting our model</a></li>
<li class="chapter" data-level="7.8" data-path="logistic-regression.html"><a href="logistic-regression.html#checking-model-adequacy"><i class="fa fa-check"></i><b>7.8</b> Checking model adequacy</a></li>
<li class="chapter" data-level="7.9" data-path="logistic-regression.html"><a href="logistic-regression.html#summary-6"><i class="fa fa-check"></i><b>7.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="poisson-regression-and-others-glms.html"><a href="poisson-regression-and-others-glms.html"><i class="fa fa-check"></i><b>8</b> Poisson regression and others GLMs</a><ul>
<li class="chapter" data-level="8.1" data-path="poisson-regression-and-others-glms.html"><a href="poisson-regression-and-others-glms.html#outline"><i class="fa fa-check"></i><b>8.1</b> Outline</a></li>
<li class="chapter" data-level="8.2" data-path="poisson-regression-and-others-glms.html"><a href="poisson-regression-and-others-glms.html#poisson-distribution"><i class="fa fa-check"></i><b>8.2</b> Poisson distribution</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html"><i class="fa fa-check"></i><b>9</b> Varying-intercept models</a><ul>
<li class="chapter" data-level="9.1" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#objectives-7"><i class="fa fa-check"></i><b>9.1</b> Objectives</a></li>
<li class="chapter" data-level="9.2" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#reading-6"><i class="fa fa-check"></i><b>9.2</b> Reading</a></li>
<li class="chapter" data-level="9.3" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#introduction-3"><i class="fa fa-check"></i><b>9.3</b> Introduction</a></li>
<li class="chapter" data-level="9.4" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#dummy-example"><i class="fa fa-check"></i><b>9.4</b> A basic model with categorical predictor</a></li>
<li class="chapter" data-level="9.5" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#notation-for-multilevel-models"><i class="fa fa-check"></i><b>9.5</b> Notation for multilevel models</a></li>
<li class="chapter" data-level="9.6" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#multilevel-example"><i class="fa fa-check"></i><b>9.6</b> From categorical predictors to varying-intercept</a></li>
<li class="chapter" data-level="9.7" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#fitting-a-multilevel-model"><i class="fa fa-check"></i><b>9.7</b> Fitting a multilevel model</a></li>
<li class="chapter" data-level="9.8" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#understanding-our-multilevel-model"><i class="fa fa-check"></i><b>9.8</b> Understanding our multilevel model</a></li>
<li class="chapter" data-level="9.9" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#a-more-complex-varying-intercept-model"><i class="fa fa-check"></i><b>9.9</b> A more complex varying-intercept model</a></li>
<li class="chapter" data-level="9.10" data-path="varying-intercept-models.html"><a href="varying-intercept-models.html#summary-7"><i class="fa fa-check"></i><b>9.10</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="vary-all.html"><a href="vary-all.html"><i class="fa fa-check"></i><b>10</b> Varying slopes and intercepts</a></li>
<li class="chapter" data-level="11" data-path="model-comparison.html"><a href="model-comparison.html"><i class="fa fa-check"></i><b>11</b> Model Comparison</a><ul>
<li class="chapter" data-level="11.1" data-path="model-comparison.html"><a href="model-comparison.html#bias-variance-trade-off"><i class="fa fa-check"></i><b>11.1</b> Bias-Variance Trade-off</a><ul>
<li class="chapter" data-level="11.1.1" data-path="model-comparison.html"><a href="model-comparison.html#rmse"><i class="fa fa-check"></i><b>11.1.1</b> RMSE</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="model-comparison.html"><a href="model-comparison.html#regularization"><i class="fa fa-check"></i><b>11.2</b> Regularization</a></li>
<li class="chapter" data-level="11.3" data-path="model-comparison.html"><a href="model-comparison.html#information-criteria-and-waic"><i class="fa fa-check"></i><b>11.3</b> Information Criteria and WAIC</a></li>
<li class="chapter" data-level="11.4" data-path="model-comparison.html"><a href="model-comparison.html#looic"><i class="fa fa-check"></i><b>11.4</b> LOO(IC)</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>12</b> Time Series</a><ul>
<li class="chapter" data-level="12.1" data-path="time-series.html"><a href="time-series.html#objectives-8"><i class="fa fa-check"></i><b>12.1</b> Objectives</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown">
Proudly published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analytical Paleobiology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="varying-intercept-models" class="section level1">
<h1><span class="header-section-number">9</span> Varying-intercept models</h1>
<div id="objectives-7" class="section level2">
<h2><span class="header-section-number">9.1</span> Objectives</h2>
<ul>
<li>Introduce multilevel structures</li>
<li>Introduce varying intercept models</li>
<li>Demonstrate how to fit a varying-intercept model.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pacman)

<span class="kw">p_load</span>(tidyverse, here, janitor, purrr, viridis, brms, tidybayes, bayesplot,
       modelr, forcats)

<span class="kw">theme_set</span>(<span class="kw">theme_bw</span>())</code></pre></div>
</div>
<div id="reading-6" class="section level2">
<h2><span class="header-section-number">9.2</span> Reading</h2>
<p>The following materials are recommended pre-readings before starting this tutorial.</p>
<ul>
<li>Chapter 12 “Multilevel Models” from <a href="https://xcelab.net/rm/statistical-rethinking/"><strong>Statistical Rethinking</strong> by Richard McElreath</a>.</li>
<li>Chapter 12 “Multilevel linear models: the basics” from <a href="https://www.cambridge.org/core/books/data-analysis-using-regression-and-multilevelhierarchical-models/32A29531C7FD730C3A68951A17C9D983"><strong>Data Analysis Using Regression and Multilevel/Hierarchical Models</strong> by Gelman and Hill</a>.<br />
</li>
<li>OPTIONAL Chapter 11 “Multilevel structures” from <a href="https://www.cambridge.org/core/books/data-analysis-using-regression-and-multilevelhierarchical-models/32A29531C7FD730C3A68951A17C9D983"><strong>Data Analysis Using Regression and Multilevel/Hierarchical Models</strong> by Gelman and Hill</a>.</li>
</ul>
<p>This lesson is a major conceptual leap forward in our studies. I highly recommend you check out <a href="http://mfviz.com/hierarchical-models/">this interactive visualization</a> to get a handle on what we’re going to be covering in this lesson. Also, if you have not already read the <a href="reg-multi.html#reg-multi">lesson on multiple predictors</a> or the <a href="interactions.html#interactions">lesson on interactions</a>, please do as there are strong conceptual similarities between those lessons and multilevel models.</p>
</div>
<div id="introduction-3" class="section level2">
<h2><span class="header-section-number">9.3</span> Introduction</h2>
<p>When collecting or analyzing data, it is not uncommon to identify groupings or nested structures underpinning our data. For example, we might have multiple measurements from the same individual or species, species co-occurrences across multiple temporal windows or localities, species from different ecological guilds, etc. Structured data is very common but the knowledge of how to model it properly is rare.</p>
<p>In our previous lessons we’ve covered how to include <a href="reg-multi.html#dummy">categorical predictors</a> in our regression models as a way to encode some of this known structure in our data. By relying on dummy variables, however, we are forcing our model to consider the different states independently because their parameters are statistically independent even though we know of the logical relationship between them. The reality of this is that we are ignoring information that could be relevant to our understanding. But we want models that use all of this information, like that omnivory and herbivory are types of trophic levels and not completely independent.</p>
<p>We want inferences about one state to possibly inform inferences about another. Importantly, this does not mean treating all states as identical. Instead, we want to understand the distribution of states within a group as well as the individual states themselves. For example, this would mean the estimating the average and spread among the trophic levels as well as the individual values for each trophic level. Simultaneously inference means we can transfer information between states and improve our inferences.</p>
<p>Multilevel models are models that remember features of each (identified) group in the data as they learn about all the states. The amount of variation among the clusters determines how much the model pools information across clusters and improving our overall estimates.</p>
<p>Pragmatic benefits of multilevel modeling:</p>
<ul>
<li><strong>Improved estimates for repeat sampling.</strong> When more than one observation arises from the same individual, location, or time, then traditional single-level models either maximally underfit or overfit the data. By identifying and modeling that repeated sampling, we can improve our estimates of the variable being measured and propagate our uncertainty about that parameter.</li>
<li><strong>Improved estimates for imbalance in sampling.</strong> When some individuals, locations, or times are sampled more than others, multilevel models automatically cope with differing uncertainty across these clusters. This prevents over-sampled clusters from unfairly dominating inference.</li>
<li><strong>Estimates of variation.</strong> If our research questions include variation among individuals or other groups within the data, then multilevel models are a big help because they model variation explicitly. Dummy coding does not include the variation between the states, which is potentially very useful information.</li>
<li><strong>Avoid averaging, retaining variation.</strong> Too often people summarize repeated sampling by pre-averaging some data to construct their variables. This can be dangerous because averaging removes variation. Also, there are lots of ways to average data. Averaging manufactures false confidence and introduces an arbitrary data transform. Multilevel models allow us to preserve our uncertainty and avoid unnecessary and unprincipled data transforms.</li>
</ul>
<p>Each of the states is considered a realization from the same population. The probability distribution for the population acts as the prior for each of the states. Except this prior isn’t exactly the same as we’re used to. Instead, this prior is actually learned from the data.</p>
<p>Multilevel regression should be the default approach to regression. In the vast majority of cases, multilevel models are superior single-level models. Once you grasp the basics of the multilevel modeling strategy it becomes much easier to incorporate related tricks such as allowing for measurement error in the data and even modeling missing data! Defining, implementing, and understanding a multilevel model is in general more complicated than a single-level model. We have to define the distribution of our states – something that sounds a lot harder than it is. Also, multilevel models are a lot harder to fit than most single-level models. This means more time tuning our MCMC algorithm, something we’ve so far been able to avoid. Finally, because multilevel models by their nature make statements at different “levels” of the data, they can be difficult for people to understanding. People rarely think about a population and the individual values within that population simultaneously.</p>
<p>Also, to make sure we’re all on the same page because the literature is full of alternative and conflicting language: multilevel = hierarchical = mixed effects. Depending on the authors background or the structure of the data, there is a change they’ll favor different language. Multilevel is probably the most generic term, and labeling your model as varying-intercepts and/or varying-slopes is certainly clearer than mixed effects model. Check out <a href="https://www.cambridge.org/core/books/data-analysis-using-regression-and-multilevelhierarchical-models/32A29531C7FD730C3A68951A17C9D983">Gelman and Hill</a> Chapter 11 for a longer discussion of the complications surrounding mixed effects model as a term.</p>
</div>
<div id="dummy-example" class="section level2">
<h2><span class="header-section-number">9.4</span> A basic model with categorical predictor</h2>
<p>The basic form of a multilevel model is termed a “varying-intercept” model. This type of model is conceptually very similar to a model with a <a href="reg-multi.html#dummy">multistate categorical predictor</a>, but instead of including <span class="math inline">\(k - 1\)</span> binary predictors in our model, we are defining a model where each state has its own intercept, and those intercepts share a common prior distribution.</p>
<p>For this example we’re going to explore how mammal species population density varies as a function of species trophic level. All this data is from the <a href="http://www.esapubs.org/archive/ecol/E090/184/default.htm">PanTHERIA dataset</a> database, a large collection of trait data for extant mammals. If you need a refresher on the definitions of the variables within this dataset, you can review the <a href="http://esapubs.org/archive/ecol/E090/184/metadata.htm">data dictionary</a>.</p>
<p>As per usual, let’s import the PanTHERIA dataset, clean it up a bit, and prepare it for further exploration and analysis. Importantly, I’m recoding <code>trophic_level</code> so that “omnivore” is the default state.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pantheria &lt;-<span class="st"> </span><span class="kw">read_tsv</span>(<span class="kw">here</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;PanTHERIA_1-0_WR05_Aug2008.txt&#39;</span>), 
                      <span class="dt">na =</span> <span class="st">&#39;-999.00&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mass_log =</span> <span class="kw">log</span>(x5_<span class="dv">1</span>_adult_body_mass_g),
         <span class="dt">range_group_log =</span> <span class="kw">log</span>(x22_<span class="dv">1</span>_home_range_km2),
         <span class="dt">range_indiv_log =</span> <span class="kw">log</span>(x22_<span class="dv">2</span>_home_range_indiv_km2),
         <span class="dt">density_log =</span> <span class="kw">log</span>(x21_<span class="dv">1</span>_population_density_n_km2),
         <span class="dt">activity_cycle =</span> <span class="kw">case_when</span>(x1_<span class="dv">1</span>_activity_cycle <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &#39;nocturnal&#39;</span>,
                                    x1_<span class="dv">1</span>_activity_cycle <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &#39;mixed&#39;</span>,
                                    x1_<span class="dv">1</span>_activity_cycle <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &#39;diurnal&#39;</span>),
         <span class="dt">trophic_level =</span> <span class="kw">case_when</span>(x6_<span class="dv">2</span>_trophic_level <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &#39;herbivore&#39;</span>,
                                   x6_<span class="dv">2</span>_trophic_level <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &#39;omnivore&#39;</span>,
                                   x6_<span class="dv">2</span>_trophic_level <span class="op">==</span><span class="st"> </span><span class="dv">3</span> <span class="op">~</span><span class="st"> &#39;carnivore&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">drop_na</span>(mass_log, density_log, trophic_level) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mass_stan =</span> arm<span class="op">::</span><span class="kw">rescale</span>(mass_log), <span class="co"># center and scale</span>
         <span class="dt">trophic_level =</span> <span class="kw">fct_infreq</span>(trophic_level)) <span class="co"># reorder by frequency</span></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   MSW05_Order = col_character(),
##   MSW05_Family = col_character(),
##   MSW05_Genus = col_character(),
##   MSW05_Species = col_character(),
##   MSW05_Binomial = col_character(),
##   References = col_character()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<p>To start, let’s write out a linear regression model where population density <span class="math inline">\(y\)</span> is predicted by trophic level dummy coded to two binary predictors: herbivory <span class="math inline">\(h\)</span> and carnivory <span class="math inline">\(c\)</span>.</p>
<p><span class="math display">\[
\begin{align}
y_{i} &amp;= \text{Normal}(\alpha + \beta_{h} h_{i} + \beta_{c} c_{i}, \sigma) \\
\alpha &amp;\sim \text{Normal}(0, 10) \\
\beta_{h} &amp;\sim \text{Normal}(0, 5) \\
\beta_{c} &amp;\sim \text{Normal}(0, 5) \\
\sigma &amp;\sim \text{Cauchy}^{+}(5) \\
\end{align}
\]</span></p>
<p>My guess is that this should look familiar. This is the way we’ve been writing out regression models with a multistate categorical predictor so far.</p>
<p><span class="math inline">\(\beta_{h}\)</span> and <span class="math inline">\(\beta_{c}\)</span> are modeled independently, which means that any information we learn about one will have no effect on our learning for the other. We know that the different trophic levels are part of the same category and are certainly not logically independent. Additionally, because of dummy coding, <span class="math inline">\(\beta_{h}\)</span> and <span class="math inline">\(\beta_{c}\)</span> are defined by their difference from <span class="math inline">\(\alpha\)</span> (the population density of omnivores).</p>
</div>
<div id="notation-for-multilevel-models" class="section level2">
<h2><span class="header-section-number">9.5</span> Notation for multilevel models</h2>
<p>To allow information about one trophic level to be shared with the other trophic levels, let’s reframe this model into a varying-intercept. Because this is our first time writing out a multilevel model, let’s first define some terms and notation. The style of notation presented here is based on <a href="https://www.cambridge.org/core/books/data-analysis-using-regression-and-multilevelhierarchical-models/32A29531C7FD730C3A68951A17C9D983">Gelman and Hill</a> and <a href="http://www.stat.columbia.edu/~gelman/book/">BDA3</a>, which is used widely and is used in the <code>brms</code> documentation.</p>
<p>Here’s a summary the notation we’ve been using so far for our regression models.</p>
<ul>
<li>Observations <span class="math inline">\(i = 1, \ldots, n\)</span> where an observation is the smallest unit of measurement (e.g. species in the PanTHERIA dataset).</li>
<li>Outcome measurement <span class="math inline">\(y = (y_{1}, \ldots, y_{n})\)</span>. These are the values being modeled (e.g. species population density).</li>
<li>Regression predictors are either vectors <span class="math inline">\(x\)</span> or <span class="math inline">\(n \times k\)</span> matrix <span class="math inline">\(X\)</span>. Unless the intercept is written out explicitly, the <a href="$matrix-notation">first column of <span class="math inline">\(X\)</span> is all 1-s</a>.</li>
<li>For each observation <span class="math inline">\(i\)</span>, its row-vector of predictors is <span class="math inline">\(X_{i}\)</span>.</li>
<li>For each predictor <span class="math inline">\(k\)</span>, the <span class="math inline">\((k + 1)^{st}\)</span> column of <span class="math inline">\(X\)</span> as <span class="math inline">\(X_{(k)}\)</span> (assuming that the first column of <span class="math inline">\(X\)</span> is a column of 1-s).</li>
<li>Coefficients are sometimes written as a vector <span class="math inline">\(\beta\)</span> and sometimes individually as <span class="math inline">\(\alpha\)</span> and one or more <span class="math inline">\(\beta\)</span>-s.</li>
<li>Any information about the unit labels <span class="math inline">\(i\)</span> should be coded in the regression inputs. For example, if <span class="math inline">\(i = 1, \ldots, n\)</span> are in temporal order, we should create a time variable <span class="math inline">\(t_{i}\)</span> and possibly include it in <span class="math inline">\(X\)</span>.</li>
</ul>
<p>As we introduce multilevel models, we also need to introduce some new notational conventions.</p>
<ul>
<li>Observations belong to a group <span class="math inline">\(j = 1, \ldots, J\)</span>. This is for single level groupings (e.g. specimens of a species).</li>
<li>For a second grouping you can use <span class="math inline">\(g = 1, \ldots, G\)</span> to indicate those memberships. You can substitute other letters if you prefer, but be careful to not overload you letters (e.g. if <span class="math inline">\(k\)</span> is the number of predictors, don’t use <span class="math inline">\(k\)</span> as a grouping).</li>
<li>Indices <span class="math inline">\(j[i]\)</span> represent group membership (“<span class="math inline">\(i\)</span> belongs to group <span class="math inline">\(j\)</span>”).</li>
<li>Group-level predictors are represented by <span class="math inline">\(u\)</span> if there is only one and by a matrix <span class="math inline">\(U\)</span> with <span class="math inline">\(J\)</span> rows if there are multiple.</li>
<li>Group-level regression coefficients are typically labeled <span class="math inline">\(\gamma\)</span>.</li>
<li><span class="math inline">\(\sigma_{y}\)</span> is the data-level standard deviation and <span class="math inline">\(\sigma_{\alpha}\)</span>, <span class="math inline">\(\sigma_{\beta}\)</span>, and so on, are for group-level standard deviations.</li>
</ul>
<p>These conventions will get us through this lesson. As more complicated situations arise, we’ll introduce additional notational conventions.</p>
</div>
<div id="multilevel-example" class="section level2">
<h2><span class="header-section-number">9.6</span> From categorical predictors to varying-intercept</h2>
<p>Now that we’ve established some ground rules, we can update our <a href="varying-intercept-models.html#dummy-example">previous model</a> with a multistate categorical predictor dummy coded to a varying-intercept model with that categorical predictor as the grouping factor.</p>
<p><span class="math display">\[
\begin{align}
y_{i} &amp;= \text{Normal}(\alpha_{j[i]}, \sigma) \\
\alpha_{j} &amp;\sim \text{Normal}(\mu_{\alpha}, \sigma_{\alpha}) \\
\mu_{\alpha} &amp;\sim \text{Normal}(0, 10) \\
\sigma &amp;\sim \text{Cauchy}^{+}(5) \\
\sigma_{\alpha} &amp;\sim \text{Normal}^{+}(1) \\
\end{align}
\]</span></p>
<p>Let’s parse out this model.</p>
<p><span class="math inline">\(\alpha_{j[i]}\)</span> is the intercept the trophic level <span class="math inline">\(j\)</span> that species <span class="math inline">\(i\)</span> belongs to. The prior for <span class="math inline">\(\alpha_{j}\)</span> is a function of two parameters, <span class="math inline">\(\mu_{\alpha}\)</span> and <span class="math inline">\(\sigma_{\alpha}\)</span>.</p>
<p>Instead of a single prior distribution for each <span class="math inline">\(j\)</span> of <span class="math inline">\(\alpha_{j}\)</span>, we’re using a distribution of distributions as a prior for all values of <span class="math inline">\(j\)</span>. The parameters of the prior then have their own priors, defined as usual.</p>
<p>This is the “multi” part of multilevel modeling – we’ve defined two levels of parameters, each of which is a simple model. We have the observation level (species), where species population densities are modeled as functions of their trophic levels. We also have a group level (trophic level) model, which describes the average population densities of the different trophic as a function of a mean of population density and its spread between the trophic levels.</p>
<p>When we fit this model to our data, we will simultaneously estimate both levels – this means that we will learn about the individual trophic levels while we also learn about the population of trophic levels.</p>
<p>Multilevel models breakdown the traditional differences between likelihood and prior. In this varying-intercepts model, can you isolate the likelihood? The prior? This flexibility and mutability in meaning and utility can be intimidating, especially if you’re coming from a fairly traditional background where parts of your model live in distinct boxes.</p>
<p>Oh, and so you know, the parameters of the prior can be referred to as <em>hyperparameters</em>, so their priors can also be referred to as hyperpriors.</p>
</div>
<div id="fitting-a-multilevel-model" class="section level2">
<h2><span class="header-section-number">9.7</span> Fitting a multilevel model</h2>
<p>So let’s fit two models – the model with trophic level dummy coded, and the model with trophic level as a varying-intercept. We can then compare posterior parameter estimates to see if anything has changed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dummy_fit &lt;-<span class="st"> </span>
<span class="st">  </span>pantheria <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> .,
      <span class="dt">family =</span> <span class="kw">gaussian</span>(),
      <span class="dt">formula =</span> <span class="kw">bf</span>(density_log <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>trophic_level),
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">class =</span> sigma)),
      <span class="dt">iter =</span> <span class="dv">2000</span>,
      <span class="dt">warmup =</span> <span class="dv">1000</span>,
      <span class="dt">chains =</span> <span class="dv">4</span>,
      <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">refresh =</span> <span class="dv">0</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(dummy_fit)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: density_log ~ 1 + trophic_level 
##    Data: . (Number of observations: 746) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##                        Estimate Est.Error l-95% CI u-95% CI Eff.Sample
## Intercept                  4.05      0.16     3.74     4.37       3185
## trophic_levelherbivore    -0.63      0.23    -1.08    -0.19       3998
## trophic_levelcarnivore    -2.14      0.34    -2.82    -1.48       3279
##                        Rhat
## Intercept              1.00
## trophic_levelherbivore 1.00
## trophic_levelcarnivore 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     2.95      0.08     2.80     3.11       3615 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multilevel_fit &lt;-<span class="st"> </span>
<span class="st">  </span>pantheria <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> .,
      <span class="dt">family =</span> <span class="kw">gaussian</span>(),
      <span class="dt">formula =</span> <span class="kw">bf</span>(density_log <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>trophic_level)),
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">class =</span> sigma),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd, <span class="dt">group =</span> trophic_level)),
      <span class="dt">iter =</span> <span class="dv">2000</span>,
      <span class="dt">warmup =</span> <span class="dv">1000</span>,
      <span class="dt">chains =</span> <span class="dv">4</span>,
      <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">refresh =</span> <span class="dv">0</span>,
      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.9</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(multilevel_fit)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: density_log ~ 1 + (1 | trophic_level) 
##    Data: . (Number of observations: 746) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~trophic_level (Number of levels: 3) 
##               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sd(Intercept)     1.13      0.44     0.52     2.18       1557 1.00
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     3.13      0.69     1.69     4.57       1259 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     2.95      0.08     2.81     3.10       2836 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>With so few trophic levels, we have to use a more informative prior than previously.</p>
<p>A lot of ink has been spilled about how many categories are necessary for multilevel modeling to be effective, and a lot of people caution against using groupings with few categories. For example, our trophic level variable only has 3 groupings and it is totally overkill to use a multilevel model instead of dummy coding the variable. With only 3 categories, it is extremely hard to get a high precision estimate of the variance between the groups, so why even estimate it?</p>
<p>When you have very few categories in your grouping factor, your results will be very sensitive to your choice of prior. Again, if you have 3 data points, it is going to be very hard to get precise estimates – you’re mostly going to get a result very similar to your prior. We can see this in one of <a href="introduction-to-bayesian-data-analysis.html#bayes-updating-ex">our first examples of Bayesian updating – as more data is added, our estimates become more precise</a>.</p>
</div>
<div id="understanding-our-multilevel-model" class="section level2">
<h2><span class="header-section-number">9.8</span> Understanding our multilevel model</h2>
<p>In our dummy model our intercept term is the average population density of omnivorous mammals, while the herbivore and carnivore terms describe the <em>difference</em> between the omnivore mean and the herbivore (or carnivore) mean. This parameteriation also does not explicitly define the difference between herbivore and carnivore average population density – that has to be calculated by hand. Make sure you can identify how all the parameters in this summary map back to our written model.</p>
<p>In contrast, for our multilevel model we have a single intercept term under “population-level effects” – this is <span class="math inline">\(\mu_{\alpha}\)</span>. There is also a new subsection titled “group-level effects” which has a single parameter <code>sd(Intercept)</code>. This standard deviation parameter is <span class="math inline">\(\sigma_{alpha}\)</span> from our model definition. What’s missing from this summary are the estimates for the different trophic levels. In our model definition these are the individual values of <span class="math inline">\(\alpha_{j}\)</span>, which describe that trophic level’s difference from the grand mean <span class="math inline">\(\mu_{\alpha}\)</span>.</p>
<p>Let’s get the posterior distributions for those differences and then calculate the estimated average population density for each trophic level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multilevel_fit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">get_variables</span>()</code></pre></div>
<pre><code>##  [1] &quot;b_Intercept&quot;                         
##  [2] &quot;sd_trophic_level__Intercept&quot;         
##  [3] &quot;sigma&quot;                               
##  [4] &quot;r_trophic_level[omnivore,Intercept]&quot; 
##  [5] &quot;r_trophic_level[herbivore,Intercept]&quot;
##  [6] &quot;r_trophic_level[carnivore,Intercept]&quot;
##  [7] &quot;lp__&quot;                                
##  [8] &quot;accept_stat__&quot;                       
##  [9] &quot;stepsize__&quot;                          
## [10] &quot;treedepth__&quot;                         
## [11] &quot;n_leapfrog__&quot;                        
## [12] &quot;divergent__&quot;                         
## [13] &quot;energy__&quot;</code></pre>
<p>Here <code>b_Intercept</code> is the global meanwhile <code>r_trophic_level[]</code> variables are the offsets from that mean for each of the trophic level states.</p>
<p><code>tidybayes</code> has convenience features to simultaneously extract all the different forms <code>r_trophic_level[]</code> appears as. Instead of writing out <code>r_trophic_level[herbivore,Intercept]</code> for each of the specific columns, we can more succinctly write out <code>r_trophic_level[state,term]</code>.</p>
<p>This syntax will return our posterior draws with <code>state</code> and <code>term</code> as columns of the relevant information (trophic level and Intercept, respectively).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multilevel_fit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread_draws</span>(r_trophic_level[state, term])</code></pre></div>
<pre><code>## # A tibble: 12,000 x 6
## # Groups:   state, term [3]
##    .chain .iteration .draw state     term      r_trophic_level
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;               &lt;dbl&gt;
##  1      1          1     1 carnivore Intercept         -1.10  
##  2      1          1     1 herbivore Intercept         -0.133 
##  3      1          1     1 omnivore  Intercept          0.744 
##  4      1          2     2 carnivore Intercept         -1.14  
##  5      1          2     2 herbivore Intercept         -0.0382
##  6      1          2     2 omnivore  Intercept          0.921 
##  7      1          3     3 carnivore Intercept         -1.04  
##  8      1          3     3 herbivore Intercept          0.646 
##  9      1          3     3 omnivore  Intercept          0.987 
## 10      1          4     4 carnivore Intercept         -1.15  
## # … with 11,990 more rows</code></pre>
<p>You can even omit the second term.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multilevel_fit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread_draws</span>(r_trophic_level[state,])</code></pre></div>
<pre><code>## # A tibble: 12,000 x 5
## # Groups:   state [3]
##    .chain .iteration .draw state     r_trophic_level
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;               &lt;dbl&gt;
##  1      1          1     1 carnivore         -1.10  
##  2      1          1     1 herbivore         -0.133 
##  3      1          1     1 omnivore           0.744 
##  4      1          2     2 carnivore         -1.14  
##  5      1          2     2 herbivore         -0.0382
##  6      1          2     2 omnivore           0.921 
##  7      1          3     3 carnivore         -1.04  
##  8      1          3     3 herbivore          0.646 
##  9      1          3     3 omnivore           0.987 
## 10      1          4     4 carnivore         -1.15  
## # … with 11,990 more rows</code></pre>
<p>We can plot the distribution of posterior estimates for each trophic level’s difference from the grand mean. Remember, the estimated average population density for each trophic level are these values <em>plus</em> the estimates for the intercept term.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multilevel_fit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread_draws</span>(r_trophic_level[state, ]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> r_trophic_level,
             <span class="dt">y =</span> state)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>))</code></pre></div>
<p><img src="paleo_book_files/figure-html/multi_est-1.png" width="672" /></p>
<p>We can also make a similar plot, but this time compare the posterior estimates of average population density by trophic group. This will be essentially the previous plot but with the intercept added to the trophic level differences.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">multilevel_fit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread_draws</span>(b_Intercept, r_trophic_level[state, ]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mean_dens =</span> b_Intercept <span class="op">+</span><span class="st"> </span>r_trophic_level) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mean_dens,
             <span class="dt">y =</span> state)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_halfeyeh</span>(<span class="dt">.width =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.8</span>))</code></pre></div>
<p><img src="paleo_book_files/figure-html/multi_w_intercept-1.png" width="672" /></p>
<p>You’ll notice the last two plots are almost identical except the first was centered about 0 and the second is (approximately) centered around 3.15.</p>
<p>But how different are our estimates for mean population density by trophic level when estimated using a single-level regression versus a multilevel regression?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">single_level &lt;-<span class="st"> </span>
<span class="st">  </span>dummy_fit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread_draws</span>(b_Intercept, 
               b_trophic_levelherbivore,
               b_trophic_levelcarnivore) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">omnivore =</span> b_Intercept,
            <span class="dt">herbivore =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_trophic_levelherbivore,
            <span class="dt">carnivore =</span> b_Intercept <span class="op">+</span><span class="st"> </span>b_trophic_levelcarnivore) <span class="op">%&gt;%</span>
<span class="st"> </span><span class="kw">gather</span>(<span class="dt">key =</span> key, <span class="dt">value =</span> value) 

multi_level &lt;-<span class="st"> </span>
<span class="st">  </span>multilevel_fit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread_draws</span>(b_Intercept, r_trophic_level[state, ]) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> state,
         <span class="dt">value =</span> b_Intercept <span class="op">+</span><span class="st"> </span>r_trophic_level) <span class="op">%&gt;%</span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(key, value)

<span class="kw">bind_rows</span>(single_level, multi_level, <span class="dt">.id =</span> <span class="st">&#39;model&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">case_when</span>(model <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">~</span><span class="st"> &#39;single&#39;</span>,
                           model <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">~</span><span class="st"> &#39;multi&#39;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">colour =</span> model, <span class="dt">fill =</span> model)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>key)</code></pre></div>
<p><img src="paleo_book_files/figure-html/compare_ests-1.png" width="672" /></p>
<p>The estimates from both models are almost identical. The only visible difference is that the estimates for mean omnivore population density, which has <em>shrunk</em> slightly towards mean. Interestingly, that estimate is our least precise one (highest variance).</p>
<p>What we have gained by using a multilevel model is a direct estimate of the variance between trophic levels, <span class="math inline">\(\sigma_{\alpha}\)</span>.</p>
<p>The distribution <span class="math inline">\(\text{Normal}(\mu_{\alpha}, \sigma_{\alpha})\)</span> defines the distribution of average population density for all trophic levels – including those which aren’t measured. Assuming that other trophic levels behave like the three we’ve observed, we can generate an average population density for that theoretical trophic level.</p>
<p>Now, this concept is probably nonsense when discussing trophic levels, but makes perfect sense in many other contexts. For example, if we were looking at population density at different sites we might want to estimate the population density at some unobserved site.</p>
</div>
<div id="a-more-complex-varying-intercept-model" class="section level2">
<h2><span class="header-section-number">9.9</span> A more complex varying-intercept model</h2>
<p>We can improve on this simple varying-intercept model by including other predictors of species population density. In this example, we will include species average body size as a predictor. This exercise is a reimplementation of <a href="reg-multi.html#reg-multi">a previous model of ours</a> but using the varying-intercepts we’ve just introduced.</p>
<p>First, let’s define this model, building on <a href="varying-intercept-models.html#multilevel-example">our earlier model of population density with just a varying intercept</a>. We have to define two terms. Let’s have <span class="math inline">\(x_{i}\)</span> signify the average body mass of species <span class="math inline">\(i\)</span>, which has been log transformed and rescaled. The parameter <span class="math inline">\(\beta\)</span> is the regression coefficient for this predictor.</p>
<p>Everything else is as before.</p>
<p><span class="math display">\[
\begin{align}
y_{i} &amp;= \text{Normal}(\alpha_{j[i]} + \beta x_{i}, \sigma) \\
\beta &amp;= \text{Normal}(0, 5) \\
\alpha_{j} &amp;\sim \text{Normal}(\mu_{\alpha}, \sigma_{\alpha}) \\
\mu_{\alpha} &amp;\sim \text{Normal}(0, 10) \\
\sigma &amp;\sim \text{Cauchy}^{+}(5) \\
\sigma_{\alpha} &amp;\sim \text{Normal}^{+}(1) \\
\end{align}
\]</span></p>
<p>As we’ve always done, we’ve added this predictor to the linear model describing the mean of <span class="math inline">\(y_{i}\)</span>. The regression coefficient has the same interpretation as usual: it describes the expected change in mean <span class="math inline">\(y\)</span> for unit change in <span class="math inline">\(x\)</span>.</p>
<p>Now that we’ve written out the model, we can fit it using <code>brm()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bigger_fit &lt;-<span class="st"> </span>
<span class="st">  </span>pantheria <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">brm</span>(<span class="dt">data =</span> .,
      <span class="dt">family =</span> <span class="kw">gaussian</span>(),
      <span class="dt">formula =</span> <span class="kw">bf</span>(density_log <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>mass_stan <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">|</span><span class="st"> </span>trophic_level)),
      <span class="dt">prior =</span> <span class="kw">c</span>(<span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="dt">class =</span> Intercept),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">class =</span> b),
                <span class="kw">prior</span>(<span class="kw">cauchy</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="dt">class =</span> sigma),
                <span class="kw">prior</span>(<span class="kw">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">class =</span> sd, <span class="dt">group =</span> trophic_level)),
      <span class="dt">iter =</span> <span class="dv">2000</span>,
      <span class="dt">warmup =</span> <span class="dv">1000</span>,
      <span class="dt">chains =</span> <span class="dv">4</span>,
      <span class="dt">cores =</span> <span class="dv">4</span>,
      <span class="dt">refresh =</span> <span class="dv">0</span>,
      <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.9</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(bigger_fit)</code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: density_log ~ 1 + mass_stan + (1 | trophic_level) 
##    Data: . (Number of observations: 746) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~trophic_level (Number of levels: 3) 
##               Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sd(Intercept)     1.26      0.44     0.62     2.29       1964 1.00
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## Intercept     3.16      0.76     1.58     4.72       1218 1.00
## mass_stan    -4.99      0.14    -5.26    -4.71       3250 1.00
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Eff.Sample Rhat
## sigma     1.80      0.05     1.71     1.89       3251 1.00
## 
## Samples were drawn using sampling(NUTS). For each parameter, Eff.Sample 
## is a crude measure of effective sample size, and Rhat is the potential 
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>There are a few things we can do with this fitted model: explore our parameter estimates, and check model adequacy. Because we skipped checking model adequacy with our just varying intercept model, let’s start with that.</p>
<p>The most basic check is plotting out data and comparing with the posterior predictions from our model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pantheria <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">mass_stan =</span> <span class="kw">seq_range</span>(mass_stan, <span class="dt">n =</span> <span class="dv">1000</span>),
            trophic_level) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predicted_draws</span>(<span class="dt">model =</span> bigger_fit,
                      <span class="dt">n =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mass_stan, <span class="dt">y =</span> .prediction)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_lineribbon</span>(<span class="kw">aes</span>(<span class="dt">group =</span> trophic_level), <span class="dt">.width =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.9</span>), <span class="dt">size =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> pantheria,
             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> density_log), <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Body mass (sd units)&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Population density&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_brewer</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>trophic_level) <span class="op">+</span>
<span class="st">  </span><span class="ot">NULL</span></code></pre></div>
<p><img src="paleo_book_files/figure-html/big_vis-1.png" width="672" /></p>
<p>The above graph should look familiar – it is almost identical to <a href="reg-multi.html#multi-ppc">one of our previous model checks</a> for our model with dummy coded <code>trophic_level</code>. This similarity makes sense because our model here is just a translation of that model into varying intercept form. Deja vu is going to be a recurring theme for the next few graphs.</p>
<p>Similarly, we can also look at how well our model reproduces the distribution of population density by trophic level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pantheria <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_predicted_draws</span>(<span class="dt">model =</span> bigger_fit,
                      <span class="dt">n =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> .prediction, <span class="dt">group =</span> .draw)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">&#39;density&#39;</span>,
            <span class="dt">alpha =</span> <span class="fl">0.1</span>,
            <span class="dt">colour =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">stat =</span> <span class="st">&#39;density&#39;</span>,
            <span class="dt">data =</span> pantheria,
            <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> density_log,
                          <span class="dt">group =</span> <span class="ot">NULL</span>),
            <span class="dt">colour =</span> <span class="st">&#39;black&#39;</span>,
            <span class="dt">size =</span> <span class="fl">1.5</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="ot">NULL</span>, <span class="dt">breaks =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(<span class="kw">paste</span>(<span class="st">&#39;Population density &#39;</span>, <span class="kw">log</span>(n <span class="op">/</span><span class="st"> </span>km<span class="op">^</span><span class="dv">2</span>))),
       <span class="dt">title =</span> <span class="st">&#39;Population density, actual versus predicted&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>trophic_level) <span class="op">+</span>
<span class="st">  </span><span class="ot">NULL</span></code></pre></div>
<p><img src="paleo_book_files/figure-html/big_dens-1.png" width="672" /></p>
<p>This plot demonstrates our model’s difficulty in fully reproducing the distribution of population densities of carnivores. This misfit suggests that carnivores have a slightly different pattern of population densities than the other two trophic levels – something we’ve noticed since our first <a href="reg-multi.html#reg-multi">multipredictor model</a>.</p>
<p>We were able to improve upon this specific modeling failure in our tutorial on <a href="interactions.html#interactions">interactions</a> by including an interaction term between trophic level and body size in our linear predictor. But how can we do that with a varying intercept term? There isn’t a covariate to define an interaction with, so what can we do? This issue is the motivation behind our next lesson on <a href="vary-all.html#vary-all">varying-slope and combined varying-intercept, varying-slope models</a>.</p>
</div>
<div id="summary-7" class="section level2">
<h2><span class="header-section-number">9.10</span> Summary</h2>
<p>This lesson was a brief introduction to multilevel models and a fast “how-to” on varying-intercept models. We covered the meaning of multilevel model and various data configurations where multilievel modeling might be appropriate. Varying-intercept models were introduced as an alternative to dummy coding of multistate categorical predictors. We covered a lot additional of notation for writing out multilevel models. After introducing all of this material, we covered fitting and extracting model estimates from our multilevel model fit using <code>brms</code>.</p>
<p>Multilevel modeling is overkill for the example from this lesson. Because of this, this section has mostly been a “how-to” because being comfortable with this type of model is important for understanding more complex models we will delve deeper into multilevel models and different types of structured data.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="poisson-regression-and-others-glms.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="vary-all.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": [["analytical_paleobiology.pdf", "PDF"], ["analytical_paleobiology.epub", "EPUB"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
