<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>1 Managing and Processing Data From the Paleobiology Database | Analytical Paleobiology</title>
  <meta name="description" content="An informal course on analytical paleobiology">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="1 Managing and Processing Data From the Paleobiology Database | Analytical Paleobiology" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="An informal course on analytical paleobiology" />
  <meta name="github-repo" content="psmits/paleo_book" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Managing and Processing Data From the Paleobiology Database | Analytical Paleobiology" />
  <meta name="twitter:site" content="@PeterDSmits" />
  <meta name="twitter:description" content="An informal course on analytical paleobiology" />
  

<meta name="author" content="Peter D Smits">


<meta name="date" content="2019-03-20">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="introduction-to-bayesian-data-analysis.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="...">Short-Course on Analytical Paleobiology</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html"><i class="fa fa-check"></i><b>1</b> Managing and Processing Data From the Paleobiology Database</a><ul>
<li class="chapter" data-level="1.1" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#project-reading"><i class="fa fa-check"></i><b>1.2</b> Reading</a></li>
<li class="chapter" data-level="1.3" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#introduction"><i class="fa fa-check"></i><b>1.3</b> Introduction</a></li>
<li class="chapter" data-level="1.4" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#getting-data"><i class="fa fa-check"></i><b>1.4</b> Getting data</a></li>
<li class="chapter" data-level="1.5" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#processing-data"><i class="fa fa-check"></i><b>1.5</b> Processing data</a></li>
<li class="chapter" data-level="1.6" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#binning-observations"><i class="fa fa-check"></i><b>1.6</b> Binning observations</a></li>
<li class="chapter" data-level="1.7" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#sharing-data"><i class="fa fa-check"></i><b>1.7</b> Sharing data</a></li>
<li class="chapter" data-level="1.8" data-path="managing-and-processing-data-from-the-paleobiology-database.html"><a href="managing-and-processing-data-from-the-paleobiology-database.html#summary"><i class="fa fa-check"></i><b>1.8</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html"><i class="fa fa-check"></i><b>2</b> Introduction to Bayesian data analysis</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#objectives-1"><i class="fa fa-check"></i><b>2.1</b> Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#reading"><i class="fa fa-check"></i><b>2.2</b> Reading</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#learning-from-data"><i class="fa fa-check"></i><b>2.3</b> Learning from data</a><ul>
<li class="chapter" data-level="2.3.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#counting-and-plausibility"><i class="fa fa-check"></i><b>2.3.1</b> Counting and plausibility</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#globe-example"><i class="fa fa-check"></i><b>2.4</b> Building a model</a><ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#a-data-story"><i class="fa fa-check"></i><b>2.4.1</b> A data story</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#bayesian-updating"><i class="fa fa-check"></i><b>2.4.2</b> Bayesian updating</a></li>
<li class="chapter" data-level="2.4.3" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#evaluate"><i class="fa fa-check"></i><b>2.4.3</b> Evaluate</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#terms-and-theory"><i class="fa fa-check"></i><b>2.5</b> Terms and theory</a></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#bayes-theorem"><i class="fa fa-check"></i><b>2.6</b> Bayes’ Theorem</a></li>
<li class="chapter" data-level="2.7" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#but-how-does-it-work"><i class="fa fa-check"></i><b>2.7</b> But how does it <em>work</em>?</a><ul>
<li class="chapter" data-level="2.7.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#grid-approximation"><i class="fa fa-check"></i><b>2.7.1</b> Grid approximation</a></li>
<li class="chapter" data-level="2.7.2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#markov-chain-monte-carlo"><i class="fa fa-check"></i><b>2.7.2</b> Markov chain Monte Carlo</a></li>
<li class="chapter" data-level="2.7.3" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#aside-on-interpreting-probabilities"><i class="fa fa-check"></i><b>2.7.3</b> Aside on Interpreting Probabilities</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#working-with-samples"><i class="fa fa-check"></i><b>2.8</b> Working with samples</a><ul>
<li class="chapter" data-level="2.8.1" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#intervals-of-defined-boundaries"><i class="fa fa-check"></i><b>2.8.1</b> Intervals of defined boundaries</a></li>
<li class="chapter" data-level="2.8.2" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>2.8.2</b> Intervals of defined mass</a></li>
<li class="chapter" data-level="2.8.3" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#point-estimates"><i class="fa fa-check"></i><b>2.8.3</b> Point estimates</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="introduction-to-bayesian-data-analysis.html"><a href="introduction-to-bayesian-data-analysis.html#summary-1"><i class="fa fa-check"></i><b>2.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="reg-intro.html"><a href="reg-intro.html"><i class="fa fa-check"></i><b>3</b> Introduction to linear regression</a><ul>
<li class="chapter" data-level="3.1" data-path="reg-intro.html"><a href="reg-intro.html#objectives-2"><i class="fa fa-check"></i><b>3.1</b> Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="reg-intro.html"><a href="reg-intro.html#reading-1"><i class="fa fa-check"></i><b>3.2</b> Reading</a></li>
<li class="chapter" data-level="3.3" data-path="reg-intro.html"><a href="reg-intro.html#linear-regression"><i class="fa fa-check"></i><b>3.3</b> Linear regression</a><ul>
<li class="chapter" data-level="3.3.1" data-path="reg-intro.html"><a href="reg-intro.html#talking-about-models"><i class="fa fa-check"></i><b>3.3.1</b> Talking about models</a></li>
<li class="chapter" data-level="3.3.2" data-path="reg-intro.html"><a href="reg-intro.html#growing-a-regression-model"><i class="fa fa-check"></i><b>3.3.2</b> Growing a regression model</a></li>
<li class="chapter" data-level="3.3.3" data-path="reg-intro.html"><a href="reg-intro.html#sampling-from-the-model"><i class="fa fa-check"></i><b>3.3.3</b> Sampling from the model</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="reg-intro.html"><a href="reg-intro.html#adding-a-predictor-to-the-mix"><i class="fa fa-check"></i><b>3.4</b> Adding a predictor to the mix</a><ul>
<li class="chapter" data-level="3.4.1" data-path="reg-intro.html"><a href="reg-intro.html#aside-dummy-coding"><i class="fa fa-check"></i><b>3.4.1</b> Aside: Dummy coding</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="reg-intro.html"><a href="reg-intro.html#interpreting-the-model-fit"><i class="fa fa-check"></i><b>3.5</b> Interpreting the model fit</a><ul>
<li class="chapter" data-level="3.5.1" data-path="reg-intro.html"><a href="reg-intro.html#linear-predictor"><i class="fa fa-check"></i><b>3.5.1</b> Linear predictor</a></li>
<li class="chapter" data-level="3.5.2" data-path="reg-intro.html"><a href="reg-intro.html#posterior-prediction"><i class="fa fa-check"></i><b>3.5.2</b> Posterior prediction</a></li>
<li class="chapter" data-level="3.5.3" data-path="reg-intro.html"><a href="reg-intro.html#posterior-predictive-tests"><i class="fa fa-check"></i><b>3.5.3</b> Posterior predictive tests</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="reg-intro.html"><a href="reg-intro.html#summary-2"><i class="fa fa-check"></i><b>3.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="reg-continue.html"><a href="reg-continue.html"><i class="fa fa-check"></i><b>4</b> Continuing with regression with continuous predictors</a><ul>
<li class="chapter" data-level="4.1" data-path="reg-continue.html"><a href="reg-continue.html#objectives-3"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="reg-continue.html"><a href="reg-continue.html#reading-2"><i class="fa fa-check"></i><b>4.2</b> Reading</a></li>
<li class="chapter" data-level="4.3" data-path="reg-continue.html"><a href="reg-continue.html#our-first-example"><i class="fa fa-check"></i><b>4.3</b> Our first example</a></li>
<li class="chapter" data-level="4.4" data-path="reg-continue.html"><a href="reg-continue.html#a-single-continuous-predictor"><i class="fa fa-check"></i><b>4.4</b> A single continuous predictor</a><ul>
<li class="chapter" data-level="4.4.1" data-path="reg-continue.html"><a href="reg-continue.html#aside-centering"><i class="fa fa-check"></i><b>4.4.1</b> Aside: Centering</a></li>
<li class="chapter" data-level="4.4.2" data-path="reg-continue.html"><a href="reg-continue.html#checking-model-fit"><i class="fa fa-check"></i><b>4.4.2</b> Checking model fit</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="reg-continue.html"><a href="reg-continue.html#summary-3"><i class="fa fa-check"></i><b>4.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html"><i class="fa fa-check"></i><b>5</b> Multiple predictors and interactions in linear regression</a><ul>
<li class="chapter" data-level="5.1" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#objectives-4"><i class="fa fa-check"></i><b>5.1</b> Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#reading-3"><i class="fa fa-check"></i><b>5.2</b> Reading</a></li>
<li class="chapter" data-level="5.3" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#more-than-one-predictor"><i class="fa fa-check"></i><b>5.3</b> More than one predictor</a><ul>
<li class="chapter" data-level="5.3.1" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#dummy"><i class="fa fa-check"></i><b>5.3.1</b> Categorical predictor</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#defining-our-model"><i class="fa fa-check"></i><b>5.4</b> Defining our model</a></li>
<li class="chapter" data-level="5.5" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#fitting-model-in-brms"><i class="fa fa-check"></i><b>5.5</b> Fitting model in <code>brms</code></a></li>
<li class="chapter" data-level="5.6" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#aside-standardizing"><i class="fa fa-check"></i><b>5.6</b> Aside: Standardizing</a></li>
<li class="chapter" data-level="5.7" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#checking-model-fit-1"><i class="fa fa-check"></i><b>5.7</b> Checking model fit</a></li>
<li class="chapter" data-level="5.8" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#matrix-notation"><i class="fa fa-check"></i><b>5.8</b> Aside: Matrix Notation</a></li>
<li class="chapter" data-level="5.9" data-path="multiple-predictors-and-interactions-in-linear-regression.html"><a href="multiple-predictors-and-interactions-in-linear-regression.html#summary-4"><i class="fa fa-check"></i><b>5.9</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>6</b> Logistic regression</a><ul>
<li class="chapter" data-level="6.1" data-path="logistic-regression.html"><a href="logistic-regression.html#objectives-5"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="logistic-regression.html"><a href="logistic-regression.html#reading-4"><i class="fa fa-check"></i><b>6.2</b> Reading</a></li>
<li class="chapter" data-level="6.3" data-path="logistic-regression.html"><a href="logistic-regression.html#introduction-1"><i class="fa fa-check"></i><b>6.3</b> Introduction</a></li>
<li class="chapter" data-level="6.4" data-path="logistic-regression.html"><a href="logistic-regression.html#foram-coiling"><i class="fa fa-check"></i><b>6.4</b> Foram coiling</a></li>
<li class="chapter" data-level="6.5" data-path="logistic-regression.html"><a href="logistic-regression.html#writing-out-a-model"><i class="fa fa-check"></i><b>6.5</b> Writing out a model</a><ul>
<li class="chapter" data-level="6.5.1" data-path="logistic-regression.html"><a href="logistic-regression.html#interpreting-logistic-regression-coefficients"><i class="fa fa-check"></i><b>6.5.1</b> Interpreting logistic regression coefficients</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="logistic-regression.html"><a href="logistic-regression.html#priors-for-our-model"><i class="fa fa-check"></i><b>6.6</b> Priors for our model</a></li>
<li class="chapter" data-level="6.7" data-path="logistic-regression.html"><a href="logistic-regression.html#fitting-our-model"><i class="fa fa-check"></i><b>6.7</b> Fitting our model</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="poisson-regression-and-others-glms.html"><a href="poisson-regression-and-others-glms.html"><i class="fa fa-check"></i><b>7</b> Poisson regression and others GLMs</a><ul>
<li class="chapter" data-level="7.1" data-path="poisson-regression-and-others-glms.html"><a href="poisson-regression-and-others-glms.html#outline"><i class="fa fa-check"></i><b>7.1</b> Outline</a></li>
<li class="chapter" data-level="7.2" data-path="poisson-regression-and-others-glms.html"><a href="poisson-regression-and-others-glms.html#poisson-distribution"><i class="fa fa-check"></i><b>7.2</b> Poisson distribution</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="varying-intercepts.html"><a href="varying-intercepts.html"><i class="fa fa-check"></i><b>8</b> Varying-intercept(s)</a><ul>
<li class="chapter" data-level="8.1" data-path="varying-intercepts.html"><a href="varying-intercepts.html#objectives-6"><i class="fa fa-check"></i><b>8.1</b> Objectives</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="varying-slopes.html"><a href="varying-slopes.html"><i class="fa fa-check"></i><b>9</b> Varying slope(s)</a></li>
<li class="chapter" data-level="10" data-path="varying-slopes-and-intercepts.html"><a href="varying-slopes-and-intercepts.html"><i class="fa fa-check"></i><b>10</b> Varying slopes and intercepts</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown">
Proudly published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Analytical Paleobiology</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="managing-and-processing-data-from-the-paleobiology-database" class="section level1">
<h1><span class="header-section-number">1</span> Managing and Processing Data From the Paleobiology Database</h1>
<div id="objectives" class="section level2">
<h2><span class="header-section-number">1.1</span> Objectives</h2>
<ul>
<li>Introduce the data stored in the Paleobiology Database.</li>
<li>Learn how to <em>programatically</em> download PBDB data.</li>
<li>Introduce tidy data and some good practices when managing data.</li>
<li>Learn how to make PBDB cleaner and tidier</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pacman)

<span class="kw">p_load</span>(tidyverse, janitor, knitr, kableExtra)

<span class="kw">theme_set</span>(<span class="kw">theme_bw</span>())</code></pre></div>
</div>
<div id="project-reading" class="section level2">
<h2><span class="header-section-number">1.2</span> Reading</h2>
<p>The following materials are recommended pre-readings before starting this section. You do not have to read all of them, just pick at least one.</p>
<ul>
<li><a href="http://www.italian-journal-of-mammalogy.it/Good-practices-for-sharing-analysis-ready-data-in-mammalogy-and-biodiversity-research,101564,0,2.html">Verde Arregotia <em>et al.</em> 2018 “Good practices for sharing analysis-ready data in mammalogy and biodiversity research” <strong>Hystrix, the Italian Journal of Mammalogy</strong></a>.</li>
<li><a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510">Wilson <em>et al.</em> 2017 “Good enough practices in scientific computing” <strong>PLoS Computational Biology</strong></a>.</li>
<li><a href="https://www.tidyverse.org/articles/2017/12/workflow-vs-script/">Bryan “Project oriented workflow” tidyverse.org</a>.</li>
<li><a href="https://speakerdeck.com/jennybc/zen-and-the-art-of-workflow-maintenance">Bryan “Zen and aRt of Workflow Maintenance” talk</a>.</li>
<li><a href="https://github.com/jennybc/code-smells-and-feels#readme">Bryan “Code Smells and Feels” talk</a>.</li>
<li><a href="https://peerj.com/preprints/3159/">Bryan 2017 “Excuse me, do you have a moment to talk about version control?” <strong>PeerJ</strong></a>.</li>
<li><a href="https://www.jstatsoft.org/article/view/v059i10">Wickham 2014 “Tidy Data”</a>.</li>
</ul>
</div>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">1.3</span> Introduction</h2>
<p>Any project you work on as a scientist has multiple parts: data, documentation, reports, code, etc. Managing and keeping track of these parts is not a simple task. Today we will discuss a small part of this process: data wrangling and sharing using the <code>tidyverse</code> set of packages and syntax. This lesson is in three parts: getting data, processing data, and sharing data.</p>
<p>This tutorial assumes a fair amount of familiarity with the <code>tidyverse</code>, in particular <code>dplyr</code>. For a tutorial on using <code>dplyr</code> and <code>purrr</code> I recommend - <a href="https://r4ds.had.co.nz/">R for Data Science</a> - <a href="https://dplyr.tidyverse.org/articles/dplyr.html" class="uri">https://dplyr.tidyverse.org/articles/dplyr.html</a>.</p>
</div>
<div id="getting-data" class="section level2">
<h2><span class="header-section-number">1.4</span> Getting data</h2>
<p>One of the greatest resources in paleobiology is the aptly named <a href="https://paleobiodb.org/">Paleobiology Database</a>, or PBDB for short. The PBDB is an internet repository of fossil occurrences, collections, taxonomic opinions, and lots of other information and is freely avalibale to everyone. The standard way to access information in the PBDB is through the classic <a href="https://paleobiodb.org/classic/displayDownloadGenerator">Download Generator</a> webform. Downloading data using forms like this makes replicating previous PBDB downloads very difficult – with so many manual options, it is hard to easily record them all or share them with someone else.</p>
<p>The modern Download Generator (at time of this writing) has one major feature for increasing the reproducibility of downloads – a URL. Every option updates a URL that calls our data from the PBDB. This URL is then a direct link to the results of that call – giving the URL to a friend means they can download the same dataset. Play around with the download options and see how the URL changes.</p>
<div class="figure">
<img src="figures/pbdb_url.png" />

</div>
<p>That URL is a call to the <a href="https://paleobiodb.org/data1.2/">PBDB’s API</a>, which is the data service for interfacing with the material stored in the underlying database. This means we can share the URL along with our study so that other researchers can make the same data call. The API documentation leaves something to be desired, but as you interact with the docs and start writing your own API calls, it should become clearer what some of the terms mean.</p>
<p>A fossil occurrence is the core data type of the PBDB and probably the most important data type in all of paleobiology – the unique recording of an organism at a particular location in space and time. Normally we want a list of fossil occurrences that correspond to our study system or period of time. For data output from the PBDB for occurrences, each row is an observation and each column is a property of that fossil or metadata corresponding to its collection, identification, and entering in the PBDB.</p>
<p>We are going to focus on downloading information about fossil occurrences. Here are a few example URLs which make calls to the PBDB API. Use the API documentation to discern and describe the differences between the different calls. You can even visit these websites if you want – it will reveal the plain-text file of the data.</p>
<pre><code>https://paleobiodb.org/data1.2/occs/list.json?base_name=Cetacea&amp;interval=Miocene&amp;show=all

https://paleobiodb.org/data1.2/occs/list.json?base_name=Cetacea&amp;interval=Miocene&amp;taxon_status=valid&amp;show=all

https://paleobiodb.org/data1.2/occs/list.txt?base_name=Cetacea&amp;interval=Miocene&amp;idreso=genus&amp;show=all

https://paleobiodb.org/data1.2/occs/taxa.txt?base_name=Cetacea&amp;interval=Miocene&amp;show=attr</code></pre>
<p>The best part of using a URL based call is that we can embed them in our R scripts. Here is a simple example (note I’m suppressing warnings here, so don’t get scared when you see a lot of them):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;</span>
carnivora &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> url)</code></pre></div>
<p>The <code>carnivora</code> object now has the information from our PBDB call in data.frame form. By using a direct API call to the PBDB instead of relying on a previously downloaded file our analyses can instaly be updated when new data is added to the PBDB. Because the URL points directly to a CSV (or JSON) file, we don’t have to save a copy of the data to our local machine and we can instead just have it live in memory during our analyses – though you might want to download and store the data every so often (e.g. <code>write_csv()</code>) so you can work offline or share you data with a less savvy colleague.</p>
<p>I find tibbles easier to process than data.frame-s, so API calls in my own code tend to look like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;</span>
carnivora &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> url) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>()</code></pre></div>
<p>If you play around with the carnivora object you’ll notice it has <strong>TONS</strong> of columns – 118! Each of these columns records some bit of information about that fossil – taxonomic identity, location, source, enterer, etc. You can check the <a href="https://paleobiodb.org/data1.2/occs/list_doc.html">API documentation</a> for a description of each column. Frustrating many of these fields might be empty or inconsistently entered – I’m looking at you lithology1 and environment. This inconsistency is the source of some of the warning messages you’ll get form <code>readr</code> functions when trying to parse PBDB data because columns will be inconsitently typed. Additionally, a lot of our fossils might not be identified to the species or even genus level, or are not identified with confidence. This serves as an important point about the PBDB: the data isn’t perfect. This means that the next step of any analysis of PBDB is “cleaning” or “tidying” our data until we can actually analyze it!</p>
<p><strong>WORD OF CAUTION:</strong> If an analysis relies entirely on the PBDB’s API to filter the data, then that analysis should be considered suspect because the authors did not actually consider the quality or nature of their data in their analysis.</p>
</div>
<div id="processing-data" class="section level2">
<h2><span class="header-section-number">1.5</span> Processing data</h2>
<p>Processing PBDB data is not a pretty task but it is extremely important and necessary before any analysis – it build familiarity with the data and ensures that the data you are analyzing is the data you actually want to analyze. The <code>dplyr</code> package from the <code>tidyverse</code> is a collection of tools for processing data.frame objects, making it easier to get our data into a usable form. When combined with the pipe operator (<code>%&gt;%</code>) from <a href="https://magrittr.tidyverse.org/"><code>magrittr</code></a>, we can write clear, human readable code for cleaning our data.</p>
<p>Example filters we might consider - identified precisely – no ambiguous or imperfect “calls” - identified to genus or better - paleocoordinates (latitude AND longitude) - body fossils - collected after a certain date</p>
<p>We might also want to standardize the form of our column names. Capital letters, spaces, and punctuation are all really frustrating to code around.</p>
<p>Lucky for us, our data is already considered “tidy” because each row is an observation and each column is a variable. This does not mean our data is ready for analysis, however. Our job as analysts is to process and filter our data till we believe every observation is ready to be analyzed. Is every observation up to snuff? Or are there errors encoded in our data?</p>
<p>For example, let’s filter out the imprecise fossils, fossils no identified to at least the genus level, and fossils lacking paleocoordinates. Let’s also make sure all the variable names have the same logic (they are all already useable, but this is a good habit to get into!)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carnivora_filter &lt;-<span class="st"> </span>
<span class="st">  </span>carnivora <span class="op">%&gt;%</span>
<span class="st">  </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st">           </span><span class="co"># standardizes names</span>
<span class="st">  </span><span class="kw">filter</span>(accepted_rank <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;genus&#39;</span>, <span class="st">&#39;species&#39;</span>), <span class="co"># either is good</span>
         <span class="op">!</span><span class="kw">is.na</span>(paleolng),
         <span class="op">!</span><span class="kw">is.na</span>(paleolat))</code></pre></div>
<p>This new tibble, <code>carnivora_filter</code>, is a subset of the ordinal data that should follow the rules we’ve laid out in the URL-based API call and the few lines of R code. If we gave the URL and this code snippet to someone else, they could reproduce all of the “rules” governing our dataset.</p>
<p>The accepted_* variables in PBDB data correspond to the accepted, or best, identification of a fossil. Differences between identified_* and accepted_* variables are commonly due to re-identification or changes in taxonomy. While this is really convenient on its face, sometimes the accepted species names assumes too much confidence in the identification. For example, let’s take a close look at a few records.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carnivora_table &lt;-<span class="st"> </span>
<span class="st">  </span>carnivora_filter <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(identified_name, 
         identified_rank, 
         accepted_name, 
         accepted_rank) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">50</span><span class="op">:</span><span class="dv">60</span>)

knitr<span class="op">::</span><span class="kw">kable</span>(carnivora_table) <span class="op">%&gt;%</span>
<span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>()</code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
identified_name
</th>
<th style="text-align:left;">
identified_rank
</th>
<th style="text-align:left;">
accepted_name
</th>
<th style="text-align:left;">
accepted_rank
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Phlaocyon minor
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Phlaocyon minor
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Desmocyon thomsoni
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Desmocyon thomsoni
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Promartes lepidus
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Promartes lepidus
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Promartes lepidus
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Promartes lepidus
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Daphoenodon notionastes
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Daphoenodon notionastes
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Daphoenodon n. sp. notionastes
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Daphoenodon notionastes
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Phlaocyon achoros
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Phlaocyon achoros
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Cynarctoides lemur
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Cynarctoides lemur
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Cormocyon cf. copei
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Cormocyon copei
</td>
<td style="text-align:left;">
species
</td>
</tr>
<tr>
<td style="text-align:left;">
Megalictis ? sp.
</td>
<td style="text-align:left;">
genus
</td>
<td style="text-align:left;">
Megalictis
</td>
<td style="text-align:left;">
genus
</td>
</tr>
<tr>
<td style="text-align:left;">
Phlaocyon ? cf. annectens
</td>
<td style="text-align:left;">
species
</td>
<td style="text-align:left;">
Phlaocyon annectens
</td>
<td style="text-align:left;">
species
</td>
</tr>
</tbody>
</table>
<p>In most cases there is good correspondence between the identified name and the accepted name, but not always. For example, the ninth of this table corresponds to a fossil identified as “Cormocyon cv. copei” but is given the accepted name of “Cormocyon copei” – an identification that is arguably overconfident. But does it matter? That’s up to you and your research, but let’s assume it does for this tutorial. How do we resolve this and downgrade these overconfident identifications?</p>
<p>The simplest way might be to downgrade any identified names that include punctuation and non-character symbols to just there genus. After all, “cf.”, “sp.” and “n. sp.” all involve punctuation.</p>
<p>But how do we deal with text information? Turns out there is a whole special language for dealing with text called <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a>, or RegEx for short. RegEx are sequences of characters that help us match specific patterns in text. In this example, I’m using a specialized bit of RegEx to identify all cases where there is punctuation present in the identified name – I don’t not care <em>where</em> the punctuation is, just that there <em>is</em> punctuation. To do this, I’m going to be using functions from the <a href="https://stringr.tidyverse.org/"><code>stringr</code></a> package which provide for easier interaction with text and regular expressions than using the factions available base R.</p>
<p>I find RegEx unintuitive before I use them as they are not intuitive, so don’t worry too much if you find regular expressions bewildering when you start using them. I always spend a lot of time on Google and StackExchange figuring out the correct RegEx I need for the task at hand.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carnivora_clean &lt;-<span class="st"> </span>
<span class="st">  </span>carnivora_filter <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">improve_name =</span> <span class="kw">if_else</span>(<span class="kw">str_detect</span>(identified_name, 
                                           <span class="dt">pattern =</span> <span class="st">&#39;[[:punct:]]&#39;</span>), 
                                <span class="dt">true =</span> genus, 
                                <span class="dt">false =</span> accepted_name))

carnivora_clean <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(identified_name, accepted_name, improve_name) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">50</span><span class="op">:</span><span class="dv">60</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">kable_styling</span>()</code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
identified_name
</th>
<th style="text-align:left;">
accepted_name
</th>
<th style="text-align:left;">
improve_name
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Phlaocyon minor
</td>
<td style="text-align:left;">
Phlaocyon minor
</td>
<td style="text-align:left;">
Phlaocyon minor
</td>
</tr>
<tr>
<td style="text-align:left;">
Desmocyon thomsoni
</td>
<td style="text-align:left;">
Desmocyon thomsoni
</td>
<td style="text-align:left;">
Desmocyon thomsoni
</td>
</tr>
<tr>
<td style="text-align:left;">
Promartes lepidus
</td>
<td style="text-align:left;">
Promartes lepidus
</td>
<td style="text-align:left;">
Promartes lepidus
</td>
</tr>
<tr>
<td style="text-align:left;">
Promartes lepidus
</td>
<td style="text-align:left;">
Promartes lepidus
</td>
<td style="text-align:left;">
Promartes lepidus
</td>
</tr>
<tr>
<td style="text-align:left;">
Daphoenodon notionastes
</td>
<td style="text-align:left;">
Daphoenodon notionastes
</td>
<td style="text-align:left;">
Daphoenodon notionastes
</td>
</tr>
<tr>
<td style="text-align:left;">
Daphoenodon n. sp. notionastes
</td>
<td style="text-align:left;">
Daphoenodon notionastes
</td>
<td style="text-align:left;">
Daphoenodon
</td>
</tr>
<tr>
<td style="text-align:left;">
Phlaocyon achoros
</td>
<td style="text-align:left;">
Phlaocyon achoros
</td>
<td style="text-align:left;">
Phlaocyon achoros
</td>
</tr>
<tr>
<td style="text-align:left;">
Cynarctoides lemur
</td>
<td style="text-align:left;">
Cynarctoides lemur
</td>
<td style="text-align:left;">
Cynarctoides lemur
</td>
</tr>
<tr>
<td style="text-align:left;">
Cormocyon cf. copei
</td>
<td style="text-align:left;">
Cormocyon copei
</td>
<td style="text-align:left;">
Cormocyon
</td>
</tr>
<tr>
<td style="text-align:left;">
Megalictis ? sp.
</td>
<td style="text-align:left;">
Megalictis
</td>
<td style="text-align:left;">
Megalictis
</td>
</tr>
<tr>
<td style="text-align:left;">
Phlaocyon ? cf. annectens
</td>
<td style="text-align:left;">
Phlaocyon annectens
</td>
<td style="text-align:left;">
Phlaocyon
</td>
</tr>
</tbody>
</table>
<p>If we really wanted to be slick, we could combine all of the above into a single block.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;</span>

carnivora &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> url) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(accepted_rank <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;genus&#39;</span>, <span class="st">&#39;species&#39;</span>), <span class="co"># either is good</span>
         <span class="op">!</span><span class="kw">is.na</span>(paleolng),
         <span class="op">!</span><span class="kw">is.na</span>(paleolat)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">improve_name =</span> <span class="kw">if_else</span>(<span class="kw">str_detect</span>(identified_name, 
                                           <span class="dt">pattern =</span> <span class="st">&#39;[[:punct:]]&#39;</span>), 
                                <span class="dt">true =</span> genus, 
                                <span class="dt">false =</span> accepted_name))</code></pre></div>
</div>
<div id="binning-observations" class="section level2">
<h2><span class="header-section-number">1.6</span> Binning observations</h2>
<p>Fossil occurrences in the PBDB have temporal information such as geologic stage, or a rough numerical age (max_ma, min_ma). The nature of the fossil record means that we do not have exact ages for anything, instead we have ranges. The numerical age of a fossil occurrence is bounded between a max and a min. This uncertainty in age presents a lot of problems that we have to deal with in our analyses, especially if the temporal order of our fossils matters to our question! An extremely common way to overcome this uncertainty is to coarsen the resolution of our fossils by binning them – assigning similarly aged fossils to a shared temporal unit. Each temporal bin can be said to have a “width” – the length of time covered by that bin.</p>
<p>In our example, we may want to track diversity over time. We are going to do this by counting the number of unique genera present in our time bins. To do this, we have to determine how many bins there are and to which bin each fossil belongs. The age of each fossil, however, is a range and not a single value. We could use the midpoint of this range to assign each fossil to a bin, but what if the age range of some fossils is much larger than our bin width? First, let’s take a look at the amount of uncertainty there is in the age estimates of our fossil occurrences.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carnivora_clean <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_range =</span> <span class="kw">abs</span>(max_ma <span class="op">-</span><span class="st"> </span>min_ma)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age_range)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&#39;Age range (My)&#39;</span>, <span class="dt">y =</span> <span class="st">&#39;Count&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="paleo_book_files/figure-html/range_ilo_carnivora-1.png" width="672" /></p>
<p>We can see that a lot of our fossils have age uncertainty of 5 million years or less, and a few of them have large ranges of 10 million years or more. Fossils with age ranges greater than 10 million years are potentially suspect or at least are not high quality – certainly trying to assign them to a single 2 million year bin isn’t going to be ideal as it adds confidence where there is none. In your own analyses you might consider these situations on a case-by-case basis or try and find more information from other sources, but for purposes of this tutorial we will exclude those occurrences who’s age ranges are 10 million years or greater.</p>
<p>We can dither over an “optimal” bin width for our data, but for the purpose of this exercise let’s just assign all our fossil occurrences to 2 million year bins.</p>
<p>Because binning data is so common, I’ve written a function, <code>bin_ages()</code> to do this. I present it here and will use it to bin our data. The <code>bin_ages()</code> function follows that convention that the youngest bin is bin 1. I’ve written documentation for this function using <code>roxygen</code> formatting. Feel free to modify it or write your own. This function requires you to assign a single age to the fossil, after which it is bined. In the example that follows, I calculate the midpoint age of each fossil and proceed from there.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#&#39; Break time data up into bins</span>
<span class="co">#&#39; </span>
<span class="co">#&#39; Have fun with this. basic rules. greater than equal to base, less than top.</span>
<span class="co">#&#39; </span>
<span class="co">#&#39; @param x vector of ages</span>
<span class="co">#&#39; @param by bin width</span>
<span class="co">#&#39; @param age logical bin age returned, not number (default FALSE, return bin number)</span>
<span class="co">#&#39; @return vector of bin memberships</span>
<span class="co">#&#39; @author Peter D Smits &lt;peterdavidsmits@gmail.com&gt;</span>
bin_ages &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">by =</span> <span class="ot">NULL</span>, <span class="dt">number =</span> <span class="ot">NULL</span>, <span class="dt">age =</span> <span class="ot">FALSE</span>) {

  <span class="cf">if</span>(<span class="kw">is.null</span>(by) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.null</span>(number)) {
    <span class="kw">return</span>(<span class="st">&#39;no scheme given. specify either bin width or number of bins.&#39;</span>)
  }

  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(by) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.null</span>(number)) {
    <span class="kw">return</span>(<span class="st">&#39;too much information. specify either bin width OR number of bins, not both.&#39;</span>)
  }

  <span class="co"># range to bin</span>
  top &lt;-<span class="st"> </span><span class="kw">ceiling</span>(<span class="kw">max</span>(x))
  bot &lt;-<span class="st"> </span><span class="kw">floor</span>(<span class="kw">min</span>(x))

  <span class="co"># create bins</span>
  <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(by)) {
    unt &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> bot, <span class="dt">to =</span> top, <span class="dt">by =</span> by)
  } <span class="cf">else</span> <span class="cf">if</span>(<span class="op">!</span><span class="kw">is.null</span>(number)) {
    unt &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> bot, <span class="dt">to =</span> top, <span class="dt">length.out =</span> number <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)
  }

  <span class="co"># bin top and bottom</span>
  unt1 &lt;-<span class="st"> </span>unt[<span class="op">-</span><span class="kw">length</span>(unt)]
  unt2 &lt;-<span class="st"> </span>unt[<span class="op">-</span><span class="dv">1</span>]

  <span class="co"># assign memberships</span>
  uu &lt;-<span class="st"> </span><span class="kw">map2</span>(unt1, unt2, <span class="op">~</span><span class="st"> </span><span class="kw">which</span>(<span class="kw">between</span>(x, <span class="dt">left =</span> .x, <span class="dt">right =</span> .y)))

  <span class="co"># what if we want the &quot;age&quot; of the bin, not just number?</span>
  <span class="cf">if</span>(age <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {
    unt_age &lt;-<span class="st"> </span><span class="kw">map2_dbl</span>(unt1, unt2, <span class="op">~</span><span class="st"> </span><span class="kw">median</span>(<span class="kw">c</span>(.x, .y)))
  }

  <span class="co"># create output vector</span>
  y &lt;-<span class="st"> </span>x
  <span class="cf">for</span>(ii <span class="cf">in</span> <span class="kw">seq</span>(<span class="kw">length</span>(uu))) {
    <span class="cf">if</span>(age <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) {
      y[uu[[ii]]] &lt;-<span class="st"> </span>ii
    } <span class="cf">else</span> <span class="cf">if</span>(age <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {
      y[uu[[ii]]] &lt;-<span class="st"> </span>unt_age[ii]
    }
  }
  y
}</code></pre></div>
<p>Let’s use this function to bin our data. Notice how I first calculate the midpoint age for each fossil and use that derived quantity to assign each occurrence to a temporal bin.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carnivora_bin &lt;-
<span class="st">  </span>carnivora_clean <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">abs</span>(max_ma <span class="op">-</span><span class="st"> </span>min_ma) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mid_ma =</span> (max_ma <span class="op">+</span><span class="st"> </span>min_ma) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>,
         <span class="dt">bin =</span> <span class="kw">bin_ages</span>(mid_ma, <span class="dt">by =</span> <span class="dv">2</span>))

carnivora_bin <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">bin_number =</span> <span class="kw">n_distinct</span>(bin))</code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   bin_number
##        &lt;int&gt;
## 1          9</code></pre>
<p>Ok, so now we have a column <code>bin</code> that identifies the temporal bin that each occurrence belongs to. The quick summary at the bottom demonstrates that we have broken our data into 9 bins of equal length. The limit here is that our bins are identified by their number and not their “age”. Luckily, the <code>age</code> parameter of the <code>bin_ages()</code> function that changes the output from bin number to bin age. Here it is in use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carnivora_bin &lt;-<span class="st"> </span>
<span class="st">  </span>carnivora_bin <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bin_age =</span> <span class="kw">bin_ages</span>(mid_ma, <span class="dt">by =</span> <span class="dv">2</span>, <span class="dt">age =</span> <span class="ot">TRUE</span>))

<span class="co"># take a look</span>
carnivora_bin <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(mid_ma, bin, bin_age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw">kable</span>(.) <span class="op">%&gt;%</span>
<span class="st">  </span>kableExtra<span class="op">::</span><span class="kw">kable_styling</span>()</code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;">
mid_ma
</th>
<th style="text-align:right;">
bin
</th>
<th style="text-align:right;">
bin_age
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
7.0165
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
7.0165
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
7.0165
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
7.0165
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
7.0165
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
7.0165
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
7.6040
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:right;">
14.8950
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
13.7890
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:right;">
13.7890
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
14
</td>
</tr>
</tbody>
</table>
<p>As before, we can combine all of these operations into a set of piped statements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;</span>
carnivora &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> url) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(accepted_rank <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;genus&#39;</span>, <span class="st">&#39;species&#39;</span>), <span class="co"># either is good</span>
         <span class="op">!</span><span class="kw">is.na</span>(paleolng),
         <span class="op">!</span><span class="kw">is.na</span>(paleolat)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">improve_name =</span> <span class="kw">if_else</span>(<span class="kw">str_detect</span>(identified_name, 
                                           <span class="dt">pattern =</span> <span class="st">&#39;[[:punct:]]&#39;</span>), 
                                <span class="dt">true =</span> genus, 
                                <span class="dt">false =</span> accepted_name)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">abs</span>(max_ma <span class="op">-</span><span class="st"> </span>min_ma) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mid_ma =</span> (max_ma <span class="op">+</span><span class="st"> </span>min_ma) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>,
         <span class="dt">bin =</span> <span class="kw">bin_ages</span>(mid_ma, <span class="dt">by =</span> <span class="dv">2</span>),
         <span class="dt">bin_age =</span> <span class="kw">bin_ages</span>(mid_ma, <span class="dt">by =</span> <span class="dv">2</span>, <span class="dt">age =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## Warning: Duplicated column names deduplicated: &#39;cc&#39; =&gt; &#39;cc_1&#39; [47]</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   occurrence_no = col_double(),
##   reid_no = col_double(),
##   flags = col_logical(),
##   collection_no = col_double(),
##   identified_no = col_double(),
##   accepted_attr = col_logical(),
##   accepted_no = col_double(),
##   max_ma = col_double(),
##   min_ma = col_double(),
##   ref_pubyr = col_double(),
##   reference_no = col_double(),
##   plant_organ = col_logical(),
##   plant_organ2 = col_logical(),
##   abund_value = col_double(),
##   lng = col_double(),
##   lat = col_double(),
##   collection_subset = col_logical(),
##   paleolng = col_double(),
##   paleolat = col_double(),
##   zone = col_logical()
##   # ... with 25 more columns
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre><code>## Warning: 1048 parsing failures.
##  row             col           expected actual                                                                                          file
## 1071 regionalsection 1/0/T/F/TRUE/FALSE  ValAH &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;
## 1071 regionalbed     1/0/T/F/TRUE/FALSE  3     &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;
## 1072 regionalsection 1/0/T/F/TRUE/FALSE  ValAH &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;
## 1072 regionalbed     1/0/T/F/TRUE/FALSE  3     &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;
## 1073 regionalsection 1/0/T/F/TRUE/FALSE  ValAH &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;
## .... ............... .................. ...... .............................................................................................
## See problems(...) for more details.</code></pre>
</div>
<div id="sharing-data" class="section level2">
<h2><span class="header-section-number">1.7</span> Sharing data</h2>
<p>So far we have generated two “kinds” of data tables: the raw data output from the PBDB that is returned from our URL-based API call, and the cleaned data we’ve crafted with a bit of code. Both of these datasets are extremely important and should be shared with the audience.</p>
<p>There are two ways to share the raw data associated with our study: the URL-based API call, and a spreadsheet of the downloaded information. Because the information on the PBDB updates over time, an API call made today might not yield an identical dataset. Earlier I hailed this as fantastic, which it is, but it is also limiting – someone might not be able completely reproduce your analysis using just this information because the data could be different. The API call is useful for improving and expanding on previous analyses, but by itself is not enough to reproduce your analysis. You also need to share the raw data download so that your complete analysis, including filtering and cleaning, is reproducible.</p>
<p>You probably also want to save a local copy of your filtered and cleaned dataset so you don’t have to re-run your cleaning scripts all the time. It also means you can separate your cleaning from the rest of your analysis. You’ll end up with multiple R scripts and multiple datasets – that’s good.</p>
<p>For example, my projects tend to have multiple subdirectories: R/, data/, and results/. In the R directory, I’ll have multiple scripts – one for loading and cleaning data, one for visualizing this cleaned data, and at least one for analyzing the cleaned data. I save the raw data to the data/ directory, and the cleaned data and figured in the results/ directory.</p>
<p>Here is a quick example of what I mean without referencing subdirectories:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">url &lt;-<span class="st"> &#39;https://paleobiodb.org/data1.2/occs/list.txt?base_name=Carnivora&amp;interval=Miocene&amp;show=full&#39;</span>
carnivora &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="dt">file =</span> url)

carnivora_clean &lt;-<span class="st"> </span>
<span class="st">  </span>carnivora <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(accepted_rank <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;genus&#39;</span>, <span class="st">&#39;species&#39;</span>), <span class="co"># either is good</span>
         <span class="op">!</span><span class="kw">is.na</span>(paleolng),
         <span class="op">!</span><span class="kw">is.na</span>(paleolat)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">improve_name =</span> <span class="kw">if_else</span>(<span class="kw">str_detect</span>(identified_name, 
                                           <span class="dt">pattern =</span> <span class="st">&#39;[[:punct:]]&#39;</span>), 
                                <span class="dt">true =</span> genus, 
                                <span class="dt">false =</span> accepted_name))
  <span class="kw">filter</span>(<span class="kw">abs</span>(max_ma <span class="op">-</span><span class="st"> </span>min_ma) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mid_ma =</span> (max_ma <span class="op">+</span><span class="st"> </span>min_ma) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>,
         <span class="dt">bin =</span> <span class="kw">bin_ages</span>(mid_ma, <span class="dt">by =</span> <span class="dv">2</span>),
         <span class="dt">bin_age =</span> <span class="kw">bin_ages</span>(mid_ma, <span class="dt">by =</span> <span class="dv">2</span>, <span class="dt">age =</span> <span class="ot">TRUE</span>))

<span class="kw">write_csv</span>(carnivora, <span class="st">&#39;carnivora_raw.csv&#39;</span>)
<span class="kw">write_csv</span>(carnivora_clean, <span class="st">&#39;carnivora_clean.csv&#39;</span>)</code></pre></div>
<p>For more information and advice on how to organize your projects, check out Jenny Bryan’s excellent material on project oriented workflows, linked <a href="managing-and-processing-data-from-the-paleobiology-database.html#project-reading">above</a>.</p>
</div>
<div id="summary" class="section level2">
<h2><span class="header-section-number">1.8</span> Summary</h2>
<p>In this lesson we introduced the PBDB API and how to include URL-based API calls in our R code. We also covered multiple aspects of cleaning PBDB data including species identifications and temporal binning. Finally, we briefly covered exporting our data, both raw and cleaned, so that our analyses are more reproducible. All of these steps are fundamental in any analysis and form a great deal of the work associated with any analysis problem.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="introduction-to-bayesian-data-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": [["analytical_paleobiology.pdf", "PDF"], ["analytical_paleobiology.epub", "EPUB"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
